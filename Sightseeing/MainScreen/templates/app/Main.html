{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Sightseeing - GOST</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'Main.css' %}?v=2">

    <style>
        /* TOP-RIGHT AVATAR + USERNAME (Matches your first image) */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: white;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
        }

        .logo {
            font-weight: 600;
            font-size: 1.4rem;
            color: #1a1a1a;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            position: relative;
        }

        .user-avatar {
            width: 36px !important;
            height: 36px !important;
            border-radius: 50% !important;
            overflow: hidden !important;
            border: 2px solid #e0e0e0 !important;
            background: #f0f0f0 !important;
            flex-shrink: 0 !important;
            position: relative !important;
        }

            .user-avatar img {
                width: 100% !important;
                height: 100% !important;
                object-fit: cover !important;
                display: block !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                z-index: 1 !important;
                /* FORCE IMAGE TO LOAD */
                image-rendering: -webkit-optimize-contrast;
            }

                /* HIDE ANY FALLBACK OR BROKEN ICON */
                .user-avatar img:not([src]),
                .user-avatar img[src=""],
                .user-avatar img[onerror] {
                    display: none !important;
                }

        .user-name {
            font-weight: 500;
            color: #1a1a1a;
            font-size: 0.9rem;
        }

        /* KEEP YOUR EXISTING POPUP STYLES UNCHANGED */
        .user-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-width: 180px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
            z-index: 1001;
        }

            .user-dropdown.show {
                opacity: 1;
                visibility: visible;
                transform: translateY(0);
            }

        .dropdown-arrow {
            position: absolute;
            top: -6px;
            right: 12px;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 6px solid white;
        }

        .dropdown-item {
            display: flex !important;
            align-items: center !important;
            padding: 12px 16px !important;
            gap: 12px !important;
            color: #333;
            text-decoration: none;
            font-size: 0.9rem;
            transition: background 0.2s;
            border-bottom: 1px solid #f0f0f0;
        }

            .dropdown-item:hover {
                background: #f8f9fa;
            }

            .dropdown-item:last-child {
                border-bottom: none;
                color: #d32f2f;
            }

                .dropdown-item:last-child:hover {
                    background: #ffebee;
                }

        /* ICON: Fixed size, centered, same line */
        .dropdown-icon {
            width: 20px !important;
            height: 20px !important;
            flex-shrink: 0 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            color: #666;
        }

        .dropdown-item.logout {
            color: #dc3545;
        }

            .dropdown-item.logout:hover {
                background: #f8d7da;
            }

        /* Main content */
        main {
            margin-top: 60px;
            padding: 20px;
        }
    </style>

</head>
<body>
    <!-- HEADER WITH AVATAR (Top-Right) -->
    <header class="header">
        <div class="logo">GOST</div>
        <div style="flex: 1;"></div>
        <div class="user-section" onclick="toggleDropdown()">
            <div class="user-avatar">
                {% if request.user.profile and request.user.profile.avatar %}
                <img src="{{ request.user.profile.avatar.url }}" alt="" onerror="this.style.display='none'">
                {% else %}
                <img src="{% static 'images/User_Default_Avatar.jpg' %}" alt="">
                {% endif %}
            </div>
            <span class="user-name">{{ request.user.username }}</span>
        </div>
    </header>

    <!-- POPUP DROPDOWN (Appears on click) -->
    <div id="userDropdown" class="user-dropdown">
        <div class="dropdown-arrow"></div>

        <!-- My Account -->
        <a href="/account/" class="dropdown-item">
            <svg class="dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
            My Account
        </a>

        <!-- Settings -->
        <a href="#" class="dropdown-item">
            <svg class="dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
            Settings
        </a>

        <!-- Support -->
        <a href="#" class="dropdown-item">
            <svg class="dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            Support
        </a>

        <!-- Logout -->
        <a href="{% url 'logout' %}" class="dropdown-item">
            <svg class="dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Logout
        </a>
    </div>

    <!-- MAIN CONTENT (Your original stuff) -->
    <main>
        <h2>Screen Main</h2>
        <p>Welcome, {{ request.user.username }}</p>
        <a href="/PreferenceScreen/">Go to preference</a><br>
        <a href="MapScreen/">Go to map</a><br>
        <a href="{% url 'logout' %}">Sign Out</a>
        {% include 'app/chat_widget.html' %}
        {% include 'app/chat_widget.html' %}
    </main>

    <!-- JAVASCRIPT FOR POPUP (Click to show/hide) -->
    <script>
        function toggleDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const userSection = document.querySelector('.user-section');
            const dropdown = document.getElementById('userDropdown');
            if (!userSection.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });
    </script>
</body>
</html>